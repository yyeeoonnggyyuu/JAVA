조인 ( 중요함!!!)

SQL 에서 조인문과 서브쿼리

조인 (집합)
ERD!!!

조인 JOIN
두 개 이상의 테이블을 연결하여 데이터를 검색하는 방법
서로 다른 테이블에 저장된 관련된 데이털르 함께 가져와 하나의 결과로 표시함
검색하고 싶은 컬럼이 서로 다른 테이블에 있을 때 사용함
조인을 사용하면 여러개의 테이블을 마치 하나의 테이블인 것처럼 쓸 수 있음

ANSI SQL 조인방식

FROM절에 있느 ㄴ두 테이블명 사이에 조인 종류에 따라 CROSS< INNER< OUTER와 함께 

Non-ANSI SQL 방식
테이블 쉼표로 구분하여 FROM절에 작성


ERD ( Entity Relationship Diagram)
-테이블 간의 관계를 설명해주는 다이어그램
-ERD 를 통해 데이터베이스의 구조를 한눈에 파악할 수 있음
-ERD를 통해 서로 관계가 있는 테이블들을 파악할 수 있음
 
열쇠 그림 : 프라이머리 키 (원래 기본키는 한개를 가지고 있음 
			유일하게 가지고 있는 키 
			부득이하게 두개를 가질경우 겹치면 안된다
 
조인의 종류 
크로스 조인 - 한쪽테이블의 각행마다 다른쪽 테이블의 모든 행이 한번씩 각각 매칭되는 조인을 의미하며 , 카티션 곱 이라고도 부름
	문법 
EX_사원 테이블과 부서 테이블을 크로스 조인하여 '배재용'사원에 대한 정보(이름, 사원 테이블의 부서번호, 부서 테이블의 부서번호, 부서명)를 보이시오
ANSI SQL 조인
SELECT 부서.부서번호
      ,부서명
      ,이름
      ,사원.부서번호
FROM 부서
CROSS JOIN 사원
WHERE 이름 = '배재용';

Non-ANSI SQL 조인
SELECT 부서.부서번호
      ,부서명
      ,이름
      ,사원.부서번호
FROM 부서
    ,사원
WHERE 이름 = '배재용';

----------------------------------------------
사원과 부서를 크로스 조인하여 이름이 이소미인 사원에대한 사원번호,직위, 사원의부서번호,부서명을 나타내시오 
on 사원.부서번호 = 부서.부서번호는 뭐야?



****************** 엄청 중요 무조건 반복해서 외우기**********************
내부 조인 (Inner Join)
각테이블에서 조인 조건에 일치되는 데이터만 가져오는 조인
내부 조인에는 이퀴조인과 비이퀴조인이 있음
이퀴조인(Equi Join) - 조인조건에 = 연사자를 사용함
비이퀴조인(Non-Equi Join) - 조인조건에 =연산자 이외의 비교 연산자를 사용

'이소미' 사원의 사원번호, 직위 , 부서번호 , 부서명을 보이시오

/*ANSI SQL*/
SELECT 사원번호
      ,직위
      ,사원.부서번호
      ,부서명
FROM 사원
INNER JOIN 부서
ON 사원.부서번호 = 부서.부서번호 // 조인조건
WHERE 이름 = '이소미';  //기타조건
사원에 부서를 이너조인해라
------------------
/*Non-ANSI SQL*/
SELECT 사원번호
      ,직위
      ,사원.부서번호
      ,부서명
FROM 사원
    ,부서
WHERE 사원.부서번호 = 부서.부서번호 // 조인조건과 기타조건
AND 이름 = '이소미';


이너조인 추가 
이소미 사원의 부서는 어디잇는 A1이다 A1은 영업부 
이소미사원의 세부정보는 사원테이블에 
A1~A4는 부서테이블에 그러니 조인을 해야함
FROM 사원
INNER JOIN 부서
이렇게 사원테이블에 부서테이블을 이너조인함
사원의 부서번호(A1)와 부서의 부서번호(A1)를 연결시키자
ON 사원.부서번호 = 부서.부서번호

프라이머리키 - 식별자
외래키 - 연결키 

-----------------------------------

고객 회사들이 주문한 주문건수를 주문건수가 많은 순서대로 보이시오. 
이때 고객 회사의 정보로는 고객번호, 담당자명, 고객회사명을 보이시오

SELECT 고객.고객번호
      ,담당자명
      ,고객회사명
      ,COUNT(*) AS 주문건수
FROM 고객
INNER JOIN 주문
ON 고객.고객번호 = 주문.고객번호
GROUP BY 고객.고객번호
		,담당자명
        ,고객회사명
ORDER BY COUNT(*) DESC;

=----------------------------
고객회사들이 주문한 주문건수를 주문건수가 많은 순서대로 보이시오
이때 고객 회사의 정보로는 고객번호, 담당자명, 고객회사명을 보이시오
select 고객.고객번호,담당자명,고객회사명
        ,count(*) AS 주문건수
from 고객, 주문
where 고객.고객번호 = 주문.고객번호
group by 1,2,3
order by count(*) DESC;

여기서
ON 고객.고객번호 = 주문.고객번호
where 고객.고객번호 = 주문.고객번호
고객테이블의 고객번호와 주문테이블의 고객번호를 연결시킨다!!!!!
------------------------------------
이중조인
고객별(고객번호,담당자명,고객회사명)로 주문금액 합을보이되, 주문금액 합이 많은 순서대로 보이시오
고객테이블, 주문테이블, 주문세부테이블의 ERD
예제 5-4 

SELECT 고객.고객번호,담당자명,고객회사명
      ,SUM(주문수량 * 단가) AS 주문금액합
FROM 고객
INNER JOIN 주문
ON 고객.고객번호 = 주문.고객번호
INNER JOIN 주문세부
ON 주문.주문번호 = 주문세부.주문번호
GROUP BY 1,2,3
ORDER BY 4 DESC;
예제 5-5
select 고객.고객번호, 담당자명, 고객회사명
		,SUM(주문수량 * 단가) AS 주문금액합
from 고객, 주문, 주문세부
where 고객.고객번호 = 주문.고객번호
AND 주문.주문번호 = 주문세부.주문번호
group by 1,2,3
order by 4 desc;
고객테이블의 고객번호 주문테이블의 고객번호 연결
주문테이블의 주문번호와 주문세부테이블의 주문번호를 연결
FROM 고객
INNER JOIN 주문
ON 고객.고객번호 = 주문.고객번호
INNER JOIN 주문세부
ON 주문.주문번호 = 주문세부.주문번호
또는
from 고객, 주문, 주문세부
where 고객.고객번호 = 주문.고객번호
AND 주문.주문번호 = 주문세부.주문번호

이렇게 하는게 이중조인
---------------------------------------
예제 5-5 조인 복습!

